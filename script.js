/* ------------------ level ------------------ */

level = [
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
]    //                                                                       â†‘

/* ---------------- fonctions ---------------- */
function orienter (n) {
    deg = n;
    joueur.style.transform = 'rotate('+deg+'deg)';
}

function monter (n) {
    y -= n;
    joueur.style.top = y.toString() + "px";
}
function sauter () {
    if ((y <= bas && h < -15) || MORT) {
        y = bas;
        joueur.style.top = y.toString() + "px";
        orienter(0);
        J=false;
        clearInterval(interval);
        return 0;
    } 
    monter(h);
    h -= 1;
    deg += 180/31;
    orienter(deg); 
}

function grid (left, top, width, height, opa) {
    d = document.createElement('div');
    d.id = "grid";
    body.appendChild(d);
    d.style.backgroundColor = "black";
    d.style.opacity = opa;
    d.style.top = top.toString() + "px";
    d.style.left = left.toString() + "px";
    d.style.width = width.toString() + "px";
    d.style.height = height.toString() + "px";
    return d;
}

function jump () {
    J=true;
    h=15;
    interval = setInterval(sauter, 1000/60);
}

function vraiY (fy) {
    fy = 700-(fy);
    fy = (fy-(fy%50))/50;
    return fy;
}

function mort (lev, yy) {
    sauv=yy;
    lev += 4;
    yy = vraiY(yy-25);
    if (yy != 0) {
        if (level[(9-yy)][lev-1] === 1 && yy != vraiY(bas)) {
            bas = y-(y%50)+50;
            y=bas
            joueur.style.top = bas + "px";
            h = -100;
            orienter(0);
        }
    }
    yy = vraiY (sauv);
    if (level[8-yy][lev] === 1) {
        MORT = true;
    }
}

/*

function vide () {

}

function tomber () {
    
}

*/

/* ----------------- projet ----------------- */

console.log("Geometry Dash !");

const body = document.querySelector('body');
const tailleY = window.innerHeight;
const tailleX = window.innerWidth;
const joueur = document.getElementById('player');
const html = document.querySelector('html');
var y = 700,
    J=false,
    sauv,
    MORT = false,
    bas = 700,
    lev=0,
    gameX=0,
    h,
    deg=0,
    hh,
    k,
    div,
    game,
    canvas;

html.onclick = function () {
    if (y === bas && !MORT) {
        jump();
    }
}

//document.querySelector('html').style.backgroundSize = taille.toString() + 'px';
joueur.style.top = y.toString() + "px";
joueur.style.left = "100px";

document.onkeydown = function(e) {
    k = e.keyCode;
    if ((k === 32 || k === 38 || k === 87) && y === bas && !MORT) {
        jump();
    } else if (k === 65) {
        /* ---------- debug ----------- */
    }
}

game=[];
level.forEach(function(item, index, array) {
    div = [];
    var b=50;
    for (i=0; i<37; i++) {
        if (item[i] === 1) {
            div.push(grid(b, 308+(index*50),48,48, 1))
            b += 50;
        } else {
            div.push(grid(b, 308+(index*50),48,48, 0));
            b += 50;
        }
    }
    game.push(div);
});


a = setInterval(function(){
    game.forEach(function(div, index, array) {
        eff=true;
        for (i=1; i<div.length; i++) {
            if (MORT) {
                clearInterval(a);
            }
            d = div[i];
            left = d.style.left;
            left = Math.round(left.substring(0,left.length-2));
            left -= 10;
            gameX+=10;
            d.style.left = left + "px";
            if (left===-50 && eff) {
                eff=false;
                d.remove();
                if (index === 0) {
                    lev++;
                }
                if (gameX<3340){
                    if (level[index][lev+36]){
                        div.push(grid(1770, 308+index*50,48,48,1));
                    } else {
                        div.push(grid(1770, 308+index*50,48,48,0));
                    }
                } else {
                    if (level[index][lev+36]){
                        div.push(grid(1760, 308+index*50,48,48,1));
                    } else {
                        div.push(grid(1760, 308+index*50,48,48,0));
                    }
                }
            }
        }})
    eff=true;
    mort(lev, y);
}, 85/3) //  85/3


